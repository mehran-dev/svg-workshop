<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Line with Side Triangles</title>
    <style>
      svg {
        width: 400px;
        height: 400px;
        border: 1px solid black;
        cursor: pointer;
      }
      .line {
        stroke: #3498db;
        stroke-width: 3;
      }
      .marker {
        fill: goldenrod;
        stroke: red;
      }

      .start-marker {
        fill: purple;
      }

      .end-marker {
        fill: yellowgreen;
      }
      .opacity-30 {
        opacity: 0.3;
      }
    </style>
  </head>
  <body>
    <svg id="svgCanvas" viewBox="0 0 400 400">
      <defs>
        <g id="myPolygon" transform="scale(0.3)">
          <path
            d="M46.967,0C21.029,0,0,21.028,0,46.967c0,25.939,21.029,46.967,46.967,46.967c25.939,0,46.967-21.027,46.967-46.967
            C93.934,21.027,72.906,0,46.967,0z M55.953,66.295V54.3H18.652V39.634h37.303V27.639l19.326,19.328L55.953,66.295z"
          />

          <!-- <path
            d="M426.443,197.455c-7.705-9.444-18.258-21.562-24.768-25.657c-6.032-3.795-13.54-8.518-23.547-8.518
c-22.483,0-32.548,12.737-32.548,25.36c0,7.543,3.743,11.937,7.293,15.35H187.67c-3.704-6.841-9.576-11.188-16.308-11.188
c-5.069,0-9.65,2.465-13.187,6.603c-3.537-4.137-8.118-6.603-13.187-6.603c-5.069,0-9.65,2.466-13.187,6.603
c-3.536-4.137-8.118-6.603-13.187-6.603c-3.224,0-6.252,0.996-8.939,2.786L95.939,179.56c-5.393-6.291-14.86-7.021-21.151-1.629
c-3.469,2.973-5.237,7.187-5.229,11.424l-8.395-9.795c-5.393-6.291-14.862-7.021-21.151-1.629
c-3.469,2.973-5.237,7.187-5.229,11.424l-8.395-9.795c-5.392-6.291-14.86-7.021-21.151-1.629c-6.29,5.391-7.019,14.86-1.628,21.15
l19.204,22.408L3.611,243.898c-5.391,6.29-4.662,15.76,1.628,21.15c2.829,2.424,6.3,3.61,9.754,3.61
c4.227,0,8.43-1.777,11.396-5.239l8.395-9.795c-0.008,4.237,1.76,8.45,5.229,11.424c2.829,2.424,6.3,3.61,9.754,3.61
c4.227,0,8.43-1.777,11.396-5.239l8.395-9.795c-0.008,4.237,1.76,8.451,5.229,11.424c2.829,2.424,6.3,3.61,9.754,3.61
c4.227,0,8.43-1.777,11.396-5.239l13.737-16.028c2.687,1.79,5.715,2.786,8.939,2.786c5.069,0,9.65-2.466,13.187-6.603
c3.536,4.137,8.118,6.603,13.187,6.603c5.069,0,9.65-2.465,13.187-6.603c3.537,4.137,8.118,6.603,13.187,6.603
c6.731,0,12.604-4.346,16.308-11.188h165.161c-3.539,3.427-7.25,7.84-7.25,15.35c0,12.623,10.064,25.36,32.548,25.36
c10.007,0,17.515-4.723,23.547-8.518c6.509-4.095,17.062-16.214,24.769-25.659c16.536-20.269,16.536-22.718,16.536-24.033
C442.98,220.173,442.98,217.722,426.443,197.455z"
          /> -->

          <!-- <g>
            <g>
              <path
                style="fill: #10bafc"
                d="M228.077,256c0-53.793-43.606-97.4-97.4-97.4c-53.796,0-97.4,43.606-97.4,97.4
            s43.604,97.4,97.4,97.4C184.471,353.4,228.077,309.793,228.077,256z"
              />
              <path
                style="fill: #10bafc"
                d="M478.722,256c0-53.793-43.604-97.4-97.4-97.4c-53.793,0-97.4,43.606-97.4,97.4
            s43.606,97.4,97.4,97.4C435.118,353.4,478.722,309.793,478.722,256z"
              />
            </g>
            <path
              d="M80.056,264.346l-3.307,3.308c-4.079,4.081-4.079,10.697,0.002,14.777c2.041,2.04,4.714,3.059,7.387,3.059
        c2.675,0,5.35-1.021,7.39-3.062l3.307-3.308c4.079-4.081,4.079-10.697-0.002-14.777S84.136,260.264,80.056,264.346z"
            />
            <path
              d="M330.662,264.346l-3.307,3.308c-4.079,4.081-4.079,10.697,0.002,14.777c2.041,2.04,4.714,3.059,7.387,3.059
        c2.675,0,5.35-1.021,7.389-3.062l3.307-3.308c4.079-4.081,4.079-10.697-0.002-14.777
        C341.358,260.263,334.742,260.264,330.662,264.346z"
            />
            <path
              d="M501.551,237.942h-13.899c-8.618-50.901-53.013-89.791-106.329-89.791c-33.293,0-63.106,15.166-82.905,38.949
        c-8.493-14.628-24.32-24.491-42.418-24.491s-33.925,9.864-42.418,24.491c-19.799-23.783-49.613-38.949-82.905-38.949
        c-53.316,0-97.712,38.89-106.329,89.791H10.449C4.678,237.942,0,242.62,0,248.391c0,5.771,4.678,10.449,10.449,10.449h12.418
        c1.511,58.161,49.292,105.009,107.812,105.009c59.468,0,107.849-48.381,107.849-107.849c0-16.651-3.795-32.433-10.563-46.526
        c1.108-14.503,13.255-25.968,28.037-25.968s26.928,11.465,28.036,25.968c-6.767,14.094-10.563,29.875-10.563,46.526
        c0,59.468,48.381,107.849,107.849,107.849c58.518,0,106.301-46.848,107.812-105.009h12.417c5.771,0,10.449-4.678,10.449-10.449
        C512,242.62,507.322,237.942,501.551,237.942z M130.677,342.951c-8.073,0-15.883-1.13-23.305-3.198l69.867-69.866
        c4.08-4.08,4.081-10.697,0.001-14.777c-4.081-4.08-10.697-4.08-14.777,0l-75.822,75.82C60.985,315.794,43.727,287.882,43.727,256
        c0-47.945,39.006-86.951,86.951-86.951c13.062,0,25.451,2.913,36.578,8.096l-63.296,63.297c-4.08,4.08-4.08,10.697,0,14.777
        c2.041,2.041,4.715,3.061,7.388,3.061s5.349-1.021,7.388-3.061l66.697-66.698c19.625,15.956,32.194,40.273,32.194,67.48
        C217.628,303.945,178.622,342.951,130.677,342.951z M381.322,342.951c-8.04,0-15.821-1.12-23.217-3.172l69.893-69.892
        c4.08-4.08,4.081-10.697,0-14.777c-4.081-4.08-10.697-4.08-14.777,0l-75.864,75.863c-25.695-15.126-42.987-43.06-42.987-74.971
        c0-47.945,39.006-86.951,86.951-86.951c13.052,0,25.431,2.909,36.552,8.083l-63.307,63.308c-4.08,4.08-4.08,10.697,0,14.777
        c2.041,2.041,4.715,3.061,7.388,3.061c2.674,0,5.349-1.021,7.388-3.061l66.714-66.715c19.638,15.956,32.216,40.281,32.216,67.497
        C468.273,303.945,429.267,342.951,381.322,342.951z"
            />
          </g> -->

          <!-- <g>
            <path
              style="fill: #ff1a1a"
              d="M256.003,439.234c0,0,109.246-80.842,185.257-160.235c21.097-24.094,34.169-52.789,34.169-84.375
        c0-67.192-54.972-121.869-122.524-121.869c-38.617,0-74.078,17.838-96.901,47.235c-22.824-29.397-58.285-47.235-96.901-47.235
        c-67.551,0-122.524,54.677-122.524,121.869c0,31.587,13.073,60.281,34.169,84.375C146.757,358.393,256.003,439.234,256.003,439.234z
        "
            />
            <path
              d="M501.551,0h-67.054c-5.771,0-10.449,4.678-10.449,10.449s4.678,10.449,10.449,10.449h41.826l-58.363,58.363
        c-19.244-10.787-41.438-16.954-65.055-16.954c-37.233,0-71.896,15.026-96.901,41.621c-25.006-26.594-59.668-41.621-96.901-41.621
        c-73.322,0-132.973,59.358-132.973,132.318c0,32.24,12.71,63.796,36.757,91.258c0.102,0.117,0.207,0.231,0.313,0.343
        c23.485,24.53,50.236,49.284,76.005,71.791l-8.514,8.514H67.965c-5.771,0-10.449,4.678-10.449,10.449s4.678,10.449,10.449,10.449
        h41.827l-6.734,6.734H40.331c-5.771,0-10.449,4.678-10.449,10.449c0,5.771,4.678,10.449,10.449,10.449h41.828l-8.987,8.987H10.449
        C4.678,424.046,0,428.724,0,434.495s4.678,10.449,10.449,10.449h41.826l-14.272,14.274c-4.08,4.08-4.08,10.696,0,14.777
        c2.041,2.041,4.715,3.06,7.388,3.06s5.349-1.02,7.388-3.06l14.274-14.274v41.83c0,5.771,4.678,10.449,10.449,10.449
        c5.771,0,10.449-4.678,10.449-10.449v-62.727l8.986-8.986v41.83c0,5.771,4.678,10.449,10.449,10.449s10.449-4.678,10.449-10.449
        v-62.727l6.734-6.734v41.829c0,5.771,4.678,10.449,10.449,10.449c5.771,0,10.449-4.678,10.449-10.449v-62.726l9.6-9.6
        c50.813,43.33,94.032,75.417,94.72,75.926c1.846,1.367,4.03,2.049,6.215,2.049c2.185,0,4.369-0.683,6.215-2.049
        c1.1-0.814,110.838-82.287,186.589-161.408c0.108-0.112,0.212-0.226,0.313-0.343c24.047-27.462,36.757-59.018,36.757-91.258
        c0-41.859-19.641-79.236-50.228-103.499l55.453-55.453v41.83c0,5.771,4.678,10.449,10.449,10.449
        c5.771,0,10.449-4.678,10.449-10.449V10.449C512,4.678,507.322,0,501.551,0z M464.979,194.625c0,27.034-10.867,53.766-31.43,77.319
        c-64.198,67.013-153.416,135.933-177.548,154.218c-13.531-10.251-47.534-36.43-86.117-69.272l93.507-93.507
        c4.08-4.08,4.08-10.696,0-14.778c-4.08-4.08-10.696-4.08-14.778,0l-94.607,94.607c-25.602-22.326-52.223-46.918-75.551-71.27
        c-20.562-23.553-31.43-50.285-31.43-77.319c0-61.437,50.277-111.42,112.075-111.42c35.024,0,67.335,15.743,88.648,43.194
        c1.98,2.55,5.026,4.041,8.254,4.041c3.228,0,6.273-1.491,8.254-4.041c21.314-27.45,53.624-43.194,88.648-43.194
        C414.703,83.205,464.979,133.188,464.979,194.625z"
            />
            <path
              d="M134.518,131.533c-27.981,14.381-45.363,42.732-45.363,73.987c0,20.286,7.949,40.087,22.99,57.263
        c2.066,2.359,4.958,3.565,7.865,3.565c2.443,0,4.897-0.852,6.88-2.588c4.341-3.802,4.779-10.403,0.978-14.744
        c-11.821-13.499-17.814-28.132-17.814-43.495c0-23.389,13.035-44.617,34.018-55.401c5.132-2.637,7.154-8.937,4.517-14.069
        C145.95,130.918,139.651,128.896,134.518,131.533z"
            />
            <path
              d="M172.761,122.306c-1.937,0-3.896,0.067-5.823,0.201c-5.757,0.397-10.102,5.385-9.705,11.143
        c0.38,5.513,4.969,9.73,10.413,9.73c0.241,0,0.485-0.008,0.729-0.025c1.45-0.1,2.926-0.15,4.385-0.15
        c5.771,0,10.449-4.678,10.449-10.449C183.21,126.984,178.532,122.306,172.761,122.306z"
            />
            <path
              d="M256.003,283.999c-2.992,0-5.84,1.282-7.823,3.522c-5.673,6.406-33.972,39.396-33.972,59.759
        c0,23.469,19.14,43.298,41.795,43.298s41.795-19.828,41.795-43.298c0-20.363-28.3-53.353-33.972-59.759
        C261.842,285.281,258.994,283.999,256.003,283.999z M256.003,369.68c-11.132,0-20.898-10.468-20.898-22.4
        c0-6.734,9.818-22.486,20.901-36.53c11.08,14.032,20.895,29.779,20.895,36.53C276.9,359.212,267.135,369.68,256.003,369.68z"
            />
          </g>
        </g> -->
      </defs>

      <line
        x1="30"
        y1="30"
        x2="200"
        y2="200"
        style="stroke: red; stroke-width: 2"
      />
      <use
        href="#myPolygon"
        x="115"
        y="115"
        fill="blue"
        transform="rotate(-45 115 115)"
      />
    </svg>

    <button id="toggleSide">Toggle Triangle Side</button>

    <script>
      const svg = document.getElementById("svgCanvas");
      let startPoint = null;
      let currentLine = null;

      svg.addEventListener("click", function (event) {
        const svgPoint = getSVGPoint(event);

        if (!startPoint) {
          startPoint = svgPoint; // Set the starting point
        } else {
          drawLine(startPoint, svgPoint); // Draw the line and triangles
          drawKuft(startPoint, svgPoint, 25, false); // Draw Kuft
          drawKuft(startPoint, svgPoint, 25, true); // Draw Kuft
          startPoint = null; // Reset start point after drawing
        }
      });

      const LINE_LENGTH = 50; // Set the desired length of the parallel line
      const TRIANGLE_HEIGHT = (Math.sqrt(3) / 2) * LINE_LENGTH; // Height of an equilateral triangle

      const drawKuft = (startPoint, endPoint, offset = 10, reverse = false) => {
        console.log("startPoint", startPoint);
        console.log("endPoint", endPoint);

        const svg = document.getElementById("svgCanvas");

        // Calculate midpoint between startPoint and endPoint
        const midX = (startPoint.x + endPoint.x) / 2;
        const midY = (startPoint.y + endPoint.y) / 2;

        // Calculate the direction vector of the line
        const dx = endPoint.x - startPoint.x;
        const dy = endPoint.y - startPoint.y;

        // Calculate the perpendicular offset direction (normal vector)
        let offsetX = -dy;
        let offsetY = dx;

        // Normalize the perpendicular vector to ensure a consistent offset distance
        const length = Math.sqrt(offsetX ** 2 + offsetY ** 2);
        offsetX = (offsetX / length) * offset;
        offsetY = (offsetY / length) * offset;

        // Adjust for reverse direction if needed
        if (reverse) {
          offsetX = -offsetX;
          offsetY = -offsetY;
        }

        // Calculate final position with offset
        const cx = midX + offsetX;
        const cy = midY + offsetY;

        // Draw the polygon instead of the circle
        const polygon = document.createElementNS(
          "http://www.w3.org/2000/svg",
          "use"
        );
        const circle = document.createElementNS(
          "http://www.w3.org/2000/svg",
          "circle"
        );

        circle.setAttribute("cx", cx);
        circle.setAttribute("cy", cy);
        circle.setAttribute("r", 5);
        //svg.appendChild(circle);

        // Calculate the angle of the line
        const angle = Math.atan2(
          endPoint.y - startPoint.y,
          endPoint.x - startPoint.x
        );

        // Rotate the polygon to be perpendicular to the line

        rotationAngle = 0;
        if (!reverse) {
          rotationAngle = angle + Math.PI / 2; // 90 degrees in radians
        } else {
          rotationAngle = angle + Math.PI + Math.PI / 2; 
        }

        polygon.setAttribute(
          "transform",
          `rotate(${rotationAngle * (180 / Math.PI)} ${cx} ${cy})`
        );

        // Get the bounding box
        const tempPolygon = document.createElementNS(
          "http://www.w3.org/2000/svg",
          "use"
        );
        tempPolygon.setAttribute("href", "#myPolygon");
        tempPolygon.setAttribute("transform", "scale(0.3)"); // Apply scale to match the actual polygon
        svg.appendChild(tempPolygon); // Add it to the SVG to measure

        const bbox = tempPolygon.getBBox();
        console.log("bbox", bbox);

        const scaledWidth = bbox.width; // Use the bounding box width
        const scaledHeight = bbox.height; // Use the bounding box height

        const centerX = cx - scaledWidth / 2; // Adjust x to center
        const centerY = cy - scaledHeight / 2; // Adjust y to center

        polygon.setAttribute("href", "#myPolygon");
        polygon.setAttribute("x", centerX);
        polygon.setAttribute("y", centerY);
        polygon.setAttribute("fill", "blue"); // Set color for the polygon
        polygon.classList.add("opacity-30");

        // Append the polygon to the SVG canvas
        svg.appendChild(polygon);

        // Draw the parallel line
        const parallelLength = LINE_LENGTH / 2; // Half length for each side from the center

        // Calculate the endpoints of the parallel line
        const parallelStartX =
          cx - parallelLength * (dx / Math.sqrt(dx * dx + dy * dy));
        const parallelStartY =
          cy - parallelLength * (dy / Math.sqrt(dx * dx + dy * dy));

        const parallelEndX =
          cx + parallelLength * (dx / Math.sqrt(dx * dx + dy * dy));
        const parallelEndY =
          cy + parallelLength * (dy / Math.sqrt(dx * dx + dy * dy));

        // Create and set attributes for the parallel line
        let parallelLine = document.createElementNS(
          "http://www.w3.org/2000/svg",
          "line"
        );
        parallelLine.setAttribute("x1", parallelStartX);
        parallelLine.setAttribute("y1", parallelStartY);
        parallelLine.setAttribute("x2", parallelEndX);
        parallelLine.setAttribute("y2", parallelEndY);
        parallelLine.setAttribute("stroke", "black"); // Set line color

        // Append the parallel line to the SVG canvas
        svg.appendChild(parallelLine);
      };

      // Get the mouse coordinates relative to the SVG
      function getSVGPoint(event) {
        const point = svg.createSVGPoint();
        point.x = event.clientX;
        point.y = event.clientY;
        const svgPoint = point.matrixTransform(svg.getScreenCTM().inverse());
        return svgPoint;
      }

      // Function to draw the line between two points and mark start/end points
      function drawLine(start, end) {
        currentLine = document.createElementNS(
          "http://www.w3.org/2000/svg",
          "line"
        );
        currentLine.setAttribute("class", "line");
        currentLine.setAttribute("x1", start.x);
        currentLine.setAttribute("y1", start.y);
        currentLine.setAttribute("x2", end.x);
        currentLine.setAttribute("y2", end.y);
        svg.appendChild(currentLine);

        // Draw a circle for the start point
        let startMarker = document.createElementNS(
          "http://www.w3.org/2000/svg",
          "circle"
        );
        startMarker.setAttribute("class", "marker end-marker");
        startMarker.setAttribute("cx", start.x);
        startMarker.setAttribute("cy", start.y);
        startMarker.setAttribute("r", 3); // Adjust radius as needed
        svg.appendChild(startMarker);

        // Calculate angle of the line for triangle rotation
        const angle = Math.atan2(end.y - start.y, end.x - start.x);

        // Draw a triangle for the end point
        const size = 12; // Size of the triangle
        const trianglePoints = [
          `${end.x},${end.y}`, // Tip of the triangle at the end point
          `${end.x - size * Math.cos(angle - Math.PI / 6)},${
            end.y - size * Math.sin(angle - Math.PI / 6)
          }`, // Bottom left
          `${end.x - size * Math.cos(angle + Math.PI / 6)},${
            end.y - size * Math.sin(angle + Math.PI / 6)
          }`, // Bottom right
        ].join(" ");

        let endMarker = document.createElementNS(
          "http://www.w3.org/2000/svg",
          "polygon"
        );
        endMarker.setAttribute("class", "marker start-marker");
        endMarker.setAttribute("points", trianglePoints);
        svg.appendChild(endMarker);
      }
    </script>
  </body>
</html>
