<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Interactive SVG with Perpendicular Lines</title>
    <style>
      svg {
        border: 1px solid #ccc;
      }
      .perpendicular {
        stroke: red;
        stroke-width: 2;
        stroke-dasharray: 5, 5; /* Stripe style */
      }
      .line {
        stroke: black;
        stroke-width: 2;
      }
    </style>
  </head>
  <body>
    <svg id="mySVG" width="500" height="500">
      <g id="perpendicularLines"></g>
      <line
        id="mainLine"
        class="line"
        x1="0"
        y1="0"
        x2="0"
        y2="0"
        visibility="hidden"
      />
      <g id="iconGroup">
        <path
          d="M3 10L6 10L6 4L10 4L10 10L13 10V11L8 16L3 11L3 10Z"
          fill="#000000"
        />
        <path d="M2 0L14 1.90735e-06V2L2 2V0Z" fill="#000000" />
      </g>
    </svg>

    <button id="togglePerpendicular">Toggle Perpendicular Lines</button>

    <script>
      const svg = document.getElementById("mySVG");
      const mainLine = document.getElementById("mainLine");
      const perpendicularLinesGroup =
        document.getElementById("perpendicularLines");
      const toggleButton = document.getElementById("togglePerpendicular");

      let points = [];
      let state = 0; // 0: no perpendicular, 1: one side, 2: both sides

      svg.addEventListener("click", (event) => {
        const rect = svg.getBoundingClientRect();
        const x = event.clientX - rect.left;
        const y = event.clientY - rect.top;

        points.push({ x, y });
        if (points.length === 1) {
          mainLine.setAttribute("x1", x);
          mainLine.setAttribute("y1", y);
          mainLine.setAttribute("x2", x);
          mainLine.setAttribute("y2", y);
          mainLine.setAttribute("visibility", "visible");
        } else if (points.length === 2) {
          mainLine.setAttribute("x2", x);
          mainLine.setAttribute("y2", y);
          drawPerpendicularLines();
          points = []; // Reset points for next line
        }
      });

      toggleButton.addEventListener("click", () => {
        state = (state + 1) % 3; // Cycle through states: 0, 1, 2
        drawPerpendicularLines();
      });

      function drawPerpendicularLines() {
        // Clear existing perpendicular lines
        while (perpendicularLinesGroup.firstChild) {
          perpendicularLinesGroup.removeChild(
            perpendicularLinesGroup.firstChild
          );
        }

        if (state === 0) return; // No perpendicular lines

        const x1 = parseFloat(mainLine.getAttribute("x1"));
        const y1 = parseFloat(mainLine.getAttribute("y1"));
        const x2 = parseFloat(mainLine.getAttribute("x2"));
        const y2 = parseFloat(mainLine.getAttribute("y2"));

        // Calculate slope and angle
        const slope = (y2 - y1) / (x2 - x1);
        const angle = Math.atan(slope);
        const length = 50; // Length of the perpendicular lines

        const dx = Math.cos(angle + Math.PI / 2) * length; // Perpendicular direction
        const dy = Math.sin(angle + Math.PI / 2) * length;

        if (state === 1 || state === 2) {
          const line1 = document.createElementNS(
            "http://www.w3.org/2000/svg",
            "line"
          );
          line1.setAttribute("class", "perpendicular");
          line1.setAttribute("x1", x1 + dx);
          line1.setAttribute("y1", y1 + dy);
          line1.setAttribute("x2", x1 + dx * 2);
          line1.setAttribute("y2", y1 + dy * 2);
          perpendicularLinesGroup.appendChild(line1);
        }

        if (state === 2) {
          const line2 = document.createElementNS(
            "http://www.w3.org/2000/svg",
            "line"
          );
          line2.setAttribute("class", "perpendicular");
          line2.setAttribute("x1", x1 - dx);
          line2.setAttribute("y1", y1 - dy);
          line2.setAttribute("x2", x1 - dx * 2);
          line2.setAttribute("y2", y1 - dy * 2);
          perpendicularLinesGroup.appendChild(line2);
        }
      }
    </script>
  </body>
</html>
